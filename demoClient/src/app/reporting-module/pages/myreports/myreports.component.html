<div fxLayout fxLayoutGap="20" class="list-container">
  <div fxLayout="column" *ngIf="showList || !isMediumDeviceOrLess" fxFlex="{{listFlexWidth}}" class="report-list">

    <div class="sort-value-block">
      <mat-form-field class="full-width">
        <input matInput placeholder="Search Report" [(ngModel)]="searchText" (ngModelChange)="applyFilters()" />
      </mat-form-field>
      <div class="create-report">
        <button name="add" mat-raised-button color="primary" routerLink="/reporting/reports/add">Generate new
          report</button>
      </div>
    </div>

    <div class="list" (onScroll)="onTableScroll()" appVirtualScroll>
      <div *ngFor="let report of items" [ngClass]="{'list-item': true, 'active': (selectedReport?.id === report.id)}"
        class="list-item" (click)="viewReport(report)">
        <span class="report-icon">
          <mat-icon>description</mat-icon>
        </span>
        <div fxLayout="fc-row" style="width: calc(100% - 24px);">
          <div class="title" fxFlex>
            {{report.title || 'Untitled report'}}</div>

        </div>
        <div class="content" style="width: calc(100% - 24px);">
          <span>{{report.description || '--'}}</span>
        </div>
        <!-- <div class="created">
          <div fxFlex="nogrow" class="badge-time">
            Created {{(report.createdDate | date:'medium')}}
          </div>
        </div> -->

        <div class="actions-menu">
          <button mat-icon-button (click)="$event.stopPropagation();" [matMenuTriggerFor]="actions">
            <mat-icon color="accent">
              more_vert
            </mat-icon>
          </button>
          <mat-menu #actions="matMenu">
            <button mat-menu-item (click)="addReporttoDashboardDialog(report)">
              <mat-icon>add</mat-icon>
              <span>Add to dashboard</span>
            </button>
            <button mat-menu-item *ngIf="!report.sharedWithMe || report.editable" (click)="editReport(report.id)">
              <mat-icon>edit</mat-icon>
              <span>Edit</span>
            </button>
            <button mat-menu-item *ngIf="!report.isResetted && report.sharedWithMe" (click)="resetReport(report.id)">
              <mat-icon>refresh</mat-icon>
              <span>Reset</span>
            </button>
            <button mat-menu-item *ngIf="!report.isRefreshed && report.sharedWithMe &&
            report.ownerSharingStatus && report.recipientSharingStatus" (click)="refreshReport(report.id)">
              <mat-icon>sync</mat-icon>
              <span>Refresh</span>
            </button>
            <button mat-menu-item *ngIf="!report.isPublished && !report.sharedWithMe"
              (click)="publishReport(report.id)">
              <mat-icon>publish</mat-icon>
              <span>Publish</span>
            </button>
            <!-- <button mat-menu-item *ngIf="!report.sharedWithMe" (click)="share(report)"> -->
            <button mat-menu-item *ngIf="!report.sharedWithMe" [matMenuTriggerFor]="sharemenu" (click)="share(report)">
              <mat-icon class="menu-icon">group_add</mat-icon>
              Share
            </button>
            <button mat-menu-item *ngIf="!report.sharedWithMe" (click)="deleteReport(report)">
              <mat-icon class="menu-icon">delete</mat-icon>
              Delete
            </button>
            <button mat-menu-item *ngIf="!report.sharedWithMe" (click)="changeOwner(report)">
              <mat-icon class="menu-icon">repeat</mat-icon>
              Transfer ownership
            </button>
          </mat-menu>
          <mat-menu #sharemenu="matMenu">
            <button mat-menu-item *ngIf="!report.sharedWithMe" (click)="share(report)">
              <mat-icon class="menu-icon">people</mat-icon>
              Share with Users/Roles
            </button>
            <button mat-menu-item *ngIf="!report.sharedWithMe" (click)="shareExternaly(report)">
              <mat-icon class="menu-icon">link</mat-icon>
              Permalink/Embed
            </button>
            <button mat-menu-item *ngIf="!report.sharedWithMe" (click)="manageSharing(report)">
              <mat-icon class="menu-icon">settings</mat-icon>
              Manage sharing
            </button>
          </mat-menu>
        </div>
        <span class="share-icon">
          <mat-icon *ngIf="report.sharedWithMe">group</mat-icon>
        </span>
      </div>
      <section class="small-spinner-container" *ngIf="isLoading">
        <mat-spinner></mat-spinner>
      </section>
      <div class="nothing-to-see" *ngIf="items.length == 0">
        <span>No Report Available</span>
      </div>
    </div>

  </div>

  <!-- <div class="ex-share-option " *ngIf="externalShareView"> -->
    <!-- <app-permalink [selectedReport]="shareReport" (externalShareView) ="closeExternalShare($event)"></app-permalink> -->
    <!-- <mat-card class="ex-share-container">
    <div class="ex-share-option-head">
      <label>
        Embed/Publish URL
      </label>
      <span (click)="closeExternalShare()" class="ex-share-option-close">
        <mat-icon class="menu-icon">clear</mat-icon>
      </span>
    </div>
    <div class="ex-share-option-body">
      <div class="access-opt option-item" [matMenuTriggerFor]="accessoptions">
        <label>Access Permission:</label>
        <span class= "viewoption">
          <label><mat-icon>{{accessOptionIcon}}</mat-icon>{{accessOptionTitle}}</label>
          <mat-icon class="menu-icon">arrow_drop_down</mat-icon>
        </span>
        <mat-menu class="access-opt-menu" #accessoptions="matMenu">
          <button (click)="selectAccessOption('Login')" mat-menu-item>
           <label title="When anyone access the URL, it will prompt for login details. Please make sure this view is shared to the user who is about to login and access.">
              <mat-icon class="menu-icon">group</mat-icon> Access with Login
            </label>
          </button>

          <button (click)="selectAccessOption('noLogin')" mat-menu-item>
           <label title="When anyone access the URL, it will not prompt for login details. Even though this view is private."> <mat-icon class="menu-icon">link_off</mat-icon> Access without Login</label>

          </button>

          <button (click)="selectAccessOption('Password')" mat-menu-item>
           <label title="When anyone access the URL, it will prompt for password. Please make sure passowrd is shared to the user who is about to access. "> <mat-icon class="menu-icon">vpn_key</mat-icon> Access with Password</label>

          </button>

        </mat-menu>
      </div>
      <div class="option-item">
        <div class="label-link">
          <label>URL for accessing this view Independently:</label>
          <a id="urltag" [href]="accessURL" target="_blank">
            <mat-icon class="menu-icon">open_in_new</mat-icon>
          </a>
        </div>
        <div class="access-url option-item">
          <label>{{accessURL}}</label>

          <button class="copy-url" color="accent" mat-flat-button>COPY</button>
        </div>
      </div>

      <div class=" option-item">
        <label>Options</label>
        <div class="access-url" flex fxLayoutGap="20px">
          <div style="border-right:2px solid lightgray " fxFlex="50">
            <div flex="100">
              <label>Include</label>
            </div>

            <br/>
            <div flex fxLayoutGap="20px">
              <mat-checkbox [(ngModel)]="this.extShareOpt.title" fxFlex="50">Title</mat-checkbox>
              <mat-checkbox [(ngModel)]="this.extShareOpt.description" fxFlex="50">Description</mat-checkbox>
              <br/>
              <mat-checkbox [(ngModel)]="this.extShareOpt.toolbar" fxFlex="100">Toolbar</mat-checkbox>
            </div>
          </div>
          <div  fxFlex="50">
            <div flex="100">
              <label>Settings</label>
            </div>

            <div flex fxLayoutGap="20px">
              <mat-checkbox>Auto refresh every
                <mat-form-field id="refreshrateinput" >
                  <input matInput placeholder="seconds" value="120" [(ngModel)]="refreshrate" />
                </mat-form-field>
                secs.
              </mat-checkbox>
            </div>


          </div>
        </div>
      </div>

      <div>
        <button  color="accent" (click)="saveAndShareExternally()" mat-flat-button>Share Externally</button>
      </div>
    </div>
    </mat-card> -->
  <!-- </div> -->

  <div class="details-container report-preview-container" fxLayout="column" *ngIf="!showList || !isMediumDeviceOrLess"
    fxFlex="{{detailsFlexWidth}}">

    <div class="fc-col-sm-12" *ngIf="isMediumDeviceOrLess">
      <button color="accent" mat-flat-button class="full-width" (click)="showList=!showList"
        class="back-to-reportlist-btn">
        <mat-icon>reply_all</mat-icon>&nbsp;&nbsp;Go back to list
      </button>
    </div>
    <!-- <div class="top-breadcrumb-container">
      <div class="top-breadcrumb">
        <h1 class="template-title">Report</h1>
        <div style="float: right;">
          <button name="add" mat-raised-button color="primary" [disabled]="!isCreatePermission"
            routerLink="reporting/items/add">Generate new report</button>
        </div>
      </div>
    </div> -->
    <div class="nothing-to-see" *ngIf="!selectedReport?.id">
      <span>No Report Seclected</span>
    </div>
    <div *ngIf="selectedReport !== undefined" style="width: 100%;" class="mt-50">
      <button mat-stroked-button color="primary" class="refresh-button" title="Refresh" (click)="refreshChart()">
        <mat-icon>
        refresh
        </mat-icon>
      </button>
      <app-chart style="width: 100%;" [ctype]="selectedReport?.ctype" [chartType]="selectedReport?.reportType"
        [query]="selectedReport?.query" [title]="selectedReport?.title"></app-chart>
    </div>
  </div>
</div>
